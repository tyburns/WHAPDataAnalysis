---
title: "Compare dimensions to mass models over years and refuges"
author: "Emilio A. Laca"
date: "10/29/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

```

## Introduction

WHAP measures linear dimensions of seed heads in the field but attempts to estimate mass of seedheads produced. Dimensions-to-mass (d2m) models are developed and used to transfor linear dimensions to estimated mass of seed heads. Then, number of seedheads per unit area and average seed head dimensions are used to estimate mass of seed heads per unit area in each of the abundance strata (low, medium and high) for each species.

Is it necessary to create a different d2m model for each location and year or is it sufficient to create one model that is applicable over refuges and years? Of course, this question can only be answered for past years and observed locations. One can assume that differences (or lack of differences) persist into the future and decide this once and for all or one can continue to test over time. This document is about exploring the answer to the question using data about seed head dimensions and mass collected in several refuges in 2019 and in Modoc in 2021.

## Data



```{r data}

st_2019 <- readRDS("st_all_noO.rds") %>%
  rename_with(~gsub(".", "_", .x, fixed = TRUE)) %>%
  mutate(year = 2019,
         spp = "SwampTimothy",
         f2t_length_mm = NA,
         length_mm = avg_length_mm,
         width_mm = NA,
         mass_mg = mass_per_sh_mg,
         LIT = substr(id, 1, 3)) %>%
  dplyr::select(LIT,
                year,
                spp,
                f2t_length_mm,
                length_mm,
                width_mm,
                mass_mg)

wg_2019 <- readRDS("wgdat.rds") %>%
  rename_with(~gsub(".", "_", .x, fixed = TRUE)) %>%
  mutate(year = 2019,
         spp = "Watergrass",
         f2t_length_mm = F2T_cm *10,
         length_mm = sh_len_cm *10,
         width_mm = NA,
         mass_mg = mass_per_sh_mg,
         LIT = refuge) %>%
  dplyr::select(LIT,
                year,
                spp,
                f2t_length_mm,
                length_mm,
                width_mm,
                mass_mg)

mdc_2021 <- readRDS("sh_dim_MDC2021.rds") %>%
  mutate(year = 2021) %>%
  dplyr::select(LIT,
                year,
                spp,
                f2t_length_mm,
                length_mm,
                width_mm,
                mass_mg)

d2m_data <- bind_rows(st_2019, wg_2019, mdc_2021)

unique(d2m_data$LIT)

# Fix LIT codes
LitKey <- c(CLS = "CLS",
            KRN = "KRN",
            PXL = "PIX",
            SAC = "SAC",
            STL = "SLW",
            PIX = "PIX",
            SL_ = "SLW",
            Colusa = "CLS",
            Sacramento = "SAC",
            StoneLakes = "SLW",
            MDC = "MDC")

d2m_data$LIT <- dplyr::recode(d2m_data$LIT, !!!LitKey)

# Create a grouping variable for LIT and year
d2m_data %<>% mutate(LIT_yr = paste(LIT, year, sep = "_"))

wg_d2m <- d2m_data %>%
  dplyr::filter(spp == "Watergrass") %>%
  arrange(LIT, year)

st_d2m <- d2m_data %>%
  dplyr::filter(spp == "SwampTimothy") %>%
  arrange(LIT, year)

```

## Models for Swamp Timothy

### Data exploration

```{r}

scatterplot(mass_mg ~ length_mm | LIT_yr, st_d2m)

```

















